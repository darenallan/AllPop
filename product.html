<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Détails Produit - Aurum</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css" />
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/app.js" defer></script>
</head>

<body>
  <header id="app-header" class="header">
      <div class="container navbar">
          <a href="index.html" class="brand">
              <span class="brand-name" style="font-size:24px; font-weight:bold;">AURUM</span>
          </a>
          <nav class="nav-actions">
              <a href="cart.html" class="icon-btn" style="position:relative;">
                  <i data-lucide="shopping-bag"></i>
                  <span class="badge" id="cart-badge" style="display:none;">0</span>
              </a>
              <button class="menu-toggle" id="menu-toggle"><i data-lucide="menu"></i></button>
          </nav>
      </div>
  </header>

  <div class="mobile-drawer" id="mobile-drawer">
      <div class="drawer-header">
          <span class="drawer-title">Menu</span>
          <button class="close-btn" id="close-btn"><i data-lucide="x"></i></button>
      </div>
      <nav class="drawer-nav">
          <a href="index.html" class="drawer-link"><i data-lucide="home"></i> Accueil</a>
          <a href="catalogue.html" class="drawer-link"><i data-lucide="grid"></i> Catalogue</a>
          <a href="cart.html" class="drawer-link"><i data-lucide="shopping-bag"></i> Panier</a>
      </nav>
  </div>
  <div id="menu-overlay"></div>

  <main class="container" style="padding: 40px 20px;">
    
    <div id="loading" style="text-align:center; padding:50px;">
        <p>Chargement du produit...</p>
    </div>

    <div id="product-container" style="display:none;">
        <div class="product-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
            
            <div class="product-images">
                <div class="main-image" style="background:#f9f9f9; border-radius:16px; overflow:hidden; margin-bottom:10px;">
                    <img id="p-image-main" src="" alt="Produit" style="width:100%; height:400px; object-fit:contain;">
                </div>
                <div class="thumbs" id="p-thumbs" style="display:flex; gap:10px; overflow-x:auto;">
                    </div>
            </div>

            <div class="product-details">
                <div style="margin-bottom:10px;">
                    <a href="#" id="p-shop-link" style="font-size:13px; text-transform:uppercase; color:#666; font-weight:600; letter-spacing:1px;">
                        <i data-lucide="store" style="width:14px;"></i> <span id="p-shop-name">...</span>
                    </a>
                </div>

                <h1 id="p-name" style="margin:0 0 15px 0;">...</h1>
                <div id="p-price" style="font-size:28px; font-weight:700; color:#D4AF37; margin-bottom:20px;">... FCFA</div>

                <p id="p-desc" style="color:#444; line-height:1.6; margin-bottom:30px;">...</p>

                <div style="display:flex; gap:15px; align-items:center;">
                    <div style="display:flex; align-items:center; border:1px solid #ddd; border-radius:8px;">
                        <button onclick="updateQty(-1)" style="background:none; border:none; padding:10px 15px; cursor:pointer;">-</button>
                        <span id="qty-display" style="font-weight:600; width:30px; text-align:center;">1</span>
                        <button onclick="updateQty(1)" style="background:none; border:none; padding:10px 15px; cursor:pointer;">+</button>
                    </div>
                    
                    <button id="add-to-cart-btn" class="btn btn-gold" style="flex:1;">
                        Ajouter au panier
                    </button>
                </div>

                <div style="margin-top:30px; padding:20px; background:#f9f9f9; border-radius:12px; font-size:13px; color:#555;">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                        <i data-lucide="truck" style="color:#D4AF37;"></i> 
                        <span>Livraison rapide partout au Burkina Faso</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <i data-lucide="shield-check" style="color:#D4AF37;"></i> 
                        <span>Paiement à la livraison ou sécurisé</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

  </main>

  <footer class="footer">
      <div class="container text-center"><p>&copy; 2026 Aurum Marketplace</p></div>
  </footer>

  <div class="toast-container" id="toast-container"></div>

  <script>
    let currentProduct = null;
    let currentQty = 1;

    document.addEventListener('DOMContentLoaded', () => {
        const db = firebase.firestore();
        const params = new URLSearchParams(window.location.search);
        const productId = params.get('id');

        if (!productId) {
            document.getElementById('loading').innerHTML = "<p>Produit introuvable.</p>";
            return;
        }

        // 1. Récupérer le produit depuis Firebase
        db.collection('products').doc(productId).get().then(doc => {
            if (doc.exists) {
                currentProduct = { id: doc.id, ...doc.data() };
                renderProduct(currentProduct);
            } else {
                document.getElementById('loading').innerHTML = "<p>Ce produit n'existe plus.</p>";
            }
        }).catch(err => {
            console.error(err);
            document.getElementById('loading').innerHTML = "<p>Erreur de chargement.</p>";
        });

        // Fonction d'affichage
        function renderProduct(p) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('product-container').style.display = 'block';

            // Textes
            document.getElementById('p-name').innerText = p.name;
            document.getElementById('p-price').innerText = new Intl.NumberFormat('fr-FR').format(p.price) + " FCFA";
            document.getElementById('p-desc').innerText = p.description || "Aucune description.";
            
            // Boutique
            document.getElementById('p-shop-name').innerText = p.shopName || "Boutique Partenaire";
            document.getElementById('p-shop-link').href = `boutique.html?id=${p.shopId}`;

            // Image Principale
            const mainImg = p.image || 'assets/img/placeholder.png';
            document.getElementById('p-image-main').src = mainImg;

            // Galerie (si plusieurs images)
            const thumbsContainer = document.getElementById('p-thumbs');
            if (p.images && p.images.length > 0) {
                p.images.forEach(imgSrc => {
                    const thumb = document.createElement('img');
                    thumb.src = imgSrc;
                    thumb.style.width = "60px";
                    thumb.style.height = "60px";
                    thumb.style.objectFit = "cover";
                    thumb.style.borderRadius = "8px";
                    thumb.style.cursor = "pointer";
                    thumb.style.border = "1px solid #ddd";
                    
                    thumb.onclick = () => {
                        document.getElementById('p-image-main').src = imgSrc;
                    };
                    thumbsContainer.appendChild(thumb);
                });
            }

            lucide.createIcons();
        }

        // 2. Gestion Panier
        document.getElementById('add-to-cart-btn').addEventListener('click', () => {
            if (typeof addToCart === 'function' && currentProduct) {
                addToCart(currentProduct.id, currentQty);
                // Animation bouton
                const btn = document.getElementById('add-to-cart-btn');
                const originalText = btn.innerText;
                btn.innerText = "Ajouté !";
                btn.style.background = "#1F8A70"; // Vert
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.style.background = ""; // Retour couleur or
                }, 2000);
            } else {
                alert("Erreur: Impossible d'ajouter au panier.");
            }
        });
    });

    // Gestion Quantité
    function updateQty(amount) {
        currentQty += amount;
        if (currentQty < 1) currentQty = 1;
        document.getElementById('qty-display').innerText = currentQty;
    }
  </script>
</body>
</html>
