<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inscription - Aurum</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="assets/css/styles.css" />
  
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- Configuration & Utilities -->
  <script src="assets/js/config.js"></script>
  <script src="assets/js/components/header.js"></script>
  <!-- App Module -->
  <script src="assets/js/app.js" defer></script>
</head>

<body>
  <div id="header-placeholder"></div>


    <main class="container">
        <section class="section">
            <div style="max-width: 400px; margin: 0 auto;">
                <h1>Créer un compte</h1>
                
                <div id="register-container" class="grid grid-1" style="gap: 15px;">
                    
                    <div class="form-group">
                        <label style="font-weight: bold;">Nom complet</label>
                        <input type="text" id="reg-name" class="input" placeholder="Votre nom">
                    </div>

                    <div class="form-group">
                        <label style="font-weight: bold;">Email</label>
                        <input type="email" id="reg-email" class="input" placeholder="exemple@gmail.com">
                    </div>

                    <div class="form-group">
                        <label style="font-weight: bold;">Mot de passe</label>
                        <input type="password" id="reg-pass" class="input" placeholder="6 caractères minimum">
                    </div>

                    <div class="form-group">
                        <label style="font-weight: bold;">Confirmer le mot de passe</label>
                        <input type="password" id="reg-pass-confirm" class="input" placeholder="Répétez le mot de passe">
                    </div>

                    <button type="button" id="btn-register" class="btn btn-gold" style="width: 100%; padding: 15px; margin-top: 10px;">
                        S'inscrire
                    </button>

                </div>
                
                <p style="margin-top: 20px; text-align: center;">
                    Déjà un compte ? <a href="login.html" style="color: var(--gold); font-weight: bold;">Se connecter</a>
                </p>

                <div id="error-message" style="color: red; text-align: center; margin-top: 10px; font-weight: bold;"></div>
            </div>
        </section>
    </main>

  <div class="toast-container" id="toast-container"></div>

  <script src="assets/js/app.js"></script>
  <script>
    // === PAGE REGISTER - LOGIQUE SPÉCIFIQUE ===
    document.addEventListener('DOMContentLoaded', () => {
        const yearSpan = document.getElementById('year');
        if (yearSpan) yearSpan.innerText = new Date().getFullYear();

        // LOGIQUE D'INSCRIPTION (CODE SPÉCIFIQUE)
        const auth = firebase.auth();
        const db = firebase.firestore();
        const btn = document.getElementById('btn-register');
        const errorDiv = document.getElementById('error-message');

        if(btn) {
            btn.addEventListener('click', function() {
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                const pass = document.getElementById('reg-pass').value;
                const passConfirm = document.getElementById('reg-pass-confirm').value;

                if(!name || !email || !pass) {
                    alert("Veuillez remplir tous les champs.");
                    return;
                }
                if(pass !== passConfirm) {
                    alert("Les mots de passe ne correspondent pas !");
                    return;
                }
                if(pass.length < 6) {
                    alert("Le mot de passe doit faire au moins 6 caractères.");
                    return;
                }

                btn.innerText = "Création en cours...";
                btn.disabled = true;
                errorDiv.innerText = "";

                window.auth.createUserWithEmailAndPassword(email, pass)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        
                        return user.updateProfile({
                            displayName: name
                        }).then(() => {
                            // Créer le document dans la collection users
                            return db.collection('users').doc(user.uid).set({
                                name: name,
                                email: email,
                                role: 'client',
                                createdAt: new Date()
                            });
                        }).then(() => {
                            const finishRedirect = () => {
                                alert("✅ Compte crée avec succès !");
                                window.location.href = "index.html";
                            };

                            if (typeof window.syncCurrentUser === 'function') {
                                return window.syncCurrentUser(user).then(finishRedirect).catch(finishRedirect);
                            }
                            finishRedirect();
                            return null;
                        });
                    })
                    .catch((error) => {
                        console.error(error);
                        let msg = "Erreur: " + error.code;
                        if (error.code === 'auth/email-already-in-use') msg = "Cet email est déjà utilisé.";
                        if (error.code === 'auth/invalid-email') msg = "Email invalide.";
                        
                        alert("⚠️ " + msg);
                        errorDiv.innerText = msg;
                        
                        btn.innerText = "S'inscrire";
                        btn.disabled = false;
                    });
            });
        }
        
        if(typeof lucide !== 'undefined') lucide.createIcons();
    });
  </script>
  <script src="assets/js/footer.js" defer></script>
</body>
</html>
