<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Espace Vendeur ‚Äî Aurum</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <link rel="stylesheet" href="assets/css/styles.css" />
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Configuration & Utilities -->
    <script src="assets/js/config.js"></script>
    <!-- Data Store -->
    <script src="assets/js/data.js" defer></script>
    <!-- Admin Module -->
    <script src="assets/js/admin.js" defer></script>

</head>
<body class="admin-layout">

    <aside class="admin-sidebar" id="seller-sidebar">
        <div class="admin-sidebar-header">
            <h1 class="admin-sidebar-title">Aurum Seller</h1>
        </div>
        <nav style="display: flex; flex-direction: column; height: 100%; overflow-y: auto;">
            <div>
                <div class="admin-nav-item active" onclick="nav('dashboard', this)">
                    <i data-lucide="layout-grid"></i> Vue d'ensemble
                </div>
                <div class="admin-nav-item" onclick="nav('products', this)">
                    <i data-lucide="package"></i> Mes Produits
                </div>
                <div class="admin-nav-item" onclick="nav('add', this)">
                    <i data-lucide="plus-circle"></i> Ajouter un produit
                </div>
                <div class="admin-nav-item" onclick="nav('orders', this)">
                    <i data-lucide="shopping-bag"></i> Commandes
                </div>
                <div class="admin-nav-item" onclick="nav('settings', this)">
                    <i data-lucide="settings"></i> Param√®tres
                </div>
            </div>
            <div style="margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                <a href="index.html" class="admin-nav-item" style="text-decoration: none;">
                    <i data-lucide="home"></i> Retour √† l'accueil
                </a>
                <div class="admin-nav-item" onclick="logout()" style="cursor: pointer;">
                    <i data-lucide="log-out"></i> D√©connexion
                </div>
            </div>
        </nav>
    </aside>

    <button class="admin-mobile-toggle" onclick="document.getElementById('seller-sidebar').classList.toggle('mobile-open')">
        <i data-lucide="menu"></i>
    </button>

    <main class="admin-main">
        
        <div id="loader" style="text-align: center; margin-top: 20%; color: #666;">
            <i data-lucide="loader" class="spin" style="animation: spin 1s infinite linear;"></i>
            <p style="margin-top: 10px;">Chargement de votre boutique...</p>
        </div>

        <div id="no-shop-warning" class="hidden" style="text-align: center; margin-top: 100px;">
            <div class="admin-card" style="max-width: 500px; margin: 0 auto; border-left: 4px solid red;">
                <h3 style="color:red;">‚ö†Ô∏è Aucune boutique trouv√©e</h3>
                <p>Aucune boutique n'est associ√©e √† l'email : <strong id="user-email-display">...</strong></p>
                <p style="font-size: 14px; color: #666;">Contactez l'administrateur pour qu'il cr√©e votre boutique avec cet email exact.</p>
            </div>
        </div>

        <div id="seller-content" class="hidden">
            
            <section id="sec-dashboard" class="admin-section active-section">
                <h1 class="admin-page-title">Ma Boutique : <span id="shop-title-display" style="color: #D4AF37;">...</span></h1>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="admin-card" style="border-left: 5px solid #D4AF37; padding: 20px;">
                        <div style="text-transform: uppercase; font-size: 12px; color: #666;">Produits en ligne</div>
                        <div style="font-size: 32px; font-weight: 700;" id="stat-products">0</div>
                    </div>
                    <div class="admin-card" style="border-left: 5px solid #D4AF37; padding: 20px;">
                        <div style="text-transform: uppercase; font-size: 12px; color: #666;">Ventes (FCFA)</div>
                        <div style="font-size: 32px; font-weight: 700;" id="stat-sales">0</div>
                    </div>
                    <div class="admin-card" style="border-left: 5px solid #D4AF37; padding: 20px;">
                        <div style="text-transform: uppercase; font-size: 12px; color: #666;">Vues Totales</div>
                        <div style="font-size: 32px; font-weight: 700;">0</div>
                    </div>
                </div>

                <div class="admin-card">
                    <h3>√âtat de la boutique</h3>
                    <p>Statut : <span id="shop-status-display" style="font-weight: bold; color: green;">Actif</span> <span id="shop-days-remaining" style="font-size: 13px; color: #666;"></span></p>
                    <p>Cat√©gorie : <span id="shop-category-display">...</span></p>
                </div>
            </section>

            <section id="sec-products" class="admin-section hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h1 class="admin-page-title" style="margin: 0;">Mes Produits</h1>
                    <button class="btn-gold" style="width: auto; margin: 0;" onclick="nav('add', document.querySelectorAll('.admin-nav-item')[2])">
                        + Ajouter
                    </button>
                </div>
                <div class="admin-card">
                    <div id="products-list">Chargement...</div>
                </div>
            </section>

            <section id="sec-add" class="admin-section hidden">
                <h1 class="admin-page-title">Nouveau Produit</h1>
                <div class="admin-card">
                    <form id="form-add-product">
                        <!-- SECTION 1: Informations de base -->
                        <div style="border-left: 4px solid #D4AF37; padding-left: 16px; margin-bottom: 24px;">
                            <h3 style="margin-top: 0; color: #333;">üìã Informations de base</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <label>Nom du produit <span style="color: red;">*</span></label>
                                    <input class="input" id="p-name" required placeholder="Ex: iPhone 13 Pro">
                                </div>
                                <div>
                                    <label>Prix unitaire (FCFA) <span style="color: red;">*</span></label>
                                    <input class="input" id="p-price" type="number" required placeholder="50000" min="0">
                                </div>
                            </div>
                            
                            <label>Description <span style="color: red;">*</span></label>
                            <textarea class="input" id="p-desc" rows="4" required placeholder="D√©crivez votre produit en d√©tail..."></textarea>
                            
                            <label>Cat√©gorie <span style="color: red;">*</span></label>
                            <select class="input" id="p-cat" required>
                                <option value="">-- S√©lectionner --</option>
                            </select>
                        </div>

                        <!-- SECTION 2: Champs dynamiques selon cat√©gorie -->
                        <div id="dynamic-fields" style="margin-bottom: 24px;"></div>

                        <!-- SECTION 3: Gestion des stocks (TOUJOURS VISIBLE) -->
                        <div style="border-left: 4px solid #10b981; padding-left: 16px; margin-bottom: 24px;">
                            <h3 style="margin-top: 0; color: #333;">üì¶ Gestion des Stocks</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                <div>
                                    <label>SKU (R√©f√©rence) <span style="color: red;">*</span></label>
                                    <input class="input" id="p-sku" required placeholder="Ex: PRD-001">
                                </div>
                                <div>
                                    <label>Quantit√© en stock <span style="color: red;">*</span></label>
                                    <input class="input" id="p-stock" type="number" required placeholder="100" min="0">
                                </div>
                                <div>
                                    <label>Seuil d'alerte stock</label>
                                    <input class="input" id="p-min-stock" type="number" placeholder="10" min="0" value="5">
                                </div>
                            </div>
                        </div>
                        
                        <!-- SECTION 4: Photos -->
                        <div style="border-left: 4px solid #3b82f6; padding-left: 16px; margin-bottom: 24px;">
                            <h3 style="margin-top: 0; color: #333;">üì∏ Photos du produit</h3>
                            <label>Images (Max 5) <span style="color: red;">*</span></label>
                            <div class="upload-area" id="drop-zone">
                                <input type="file" id="p-files" accept="image/*" multiple hidden>
                                <div class="upload-content" id="upload-content">
                                    <i data-lucide="image-plus" style="width: 48px; height: 48px; color: #D4AF37; margin-bottom: 10px;"></i>
                                    <p style="margin: 0; font-weight: 500;">Glissez vos images ici ou <span style="color: #D4AF37; cursor: pointer; text-decoration: underline;">parcourez</span></p>
                                    <p style="margin: 5px 0 0 0; font-size: 12px; color: #999;">JPG, PNG (Max 2Mo par image)</p>
                                </div>
                            </div>
                            <div id="preview-gallery" class="preview-gallery"></div>
                        </div>

                        <button class="btn-gold" id="btn-submit-product" type="submit" style="margin-top: 20px;">
                            <i data-lucide="plus-circle" style="width: 20px; height: 20px;"></i> Mettre en vente
                        </button>
                    </form>
                </div>
            </section>

            <section id="sec-orders" class="admin-section hidden">
                <h1 class="admin-page-title">Commandes</h1>
                <div class="admin-card">
                    <div id="orders-loader" style="text-align:center; padding:40px;">
                        <p class="text-muted">Chargement des commandes...</p>
                    </div>
                    <div id="orders-container" style="display:none;">
                        <div id="orders-retention-controls" style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
                            <span id="seller-retention-note" style="color:#666; font-size:13px;">Les commandes livr√©es/annul√©es sont automatiquement supprim√©es apr√®s 30 jours.</span>
                            <span class="retention-help" tabindex="0" aria-label="Aide sur la conservation" style="position:relative; display:inline-flex; align-items:center; cursor:help; color:#666;">
                                <i data-lucide="help-circle"></i>
                                <span class="tooltip-content" style="position:absolute; left:0; top:130%; background:#111; color:#fff; padding:8px 10px; border-radius:6px; font-size:12px; width:280px; box-shadow:0 6px 16px rgba(0,0,0,0.2); opacity:0; pointer-events:none; transform:translateY(4px); transition:opacity .15s, transform .15s; z-index:10;">
                                    Les commandes livr√©es ou annul√©es sont supprim√©es automatiquement apr√®s la p√©riode d√©finie. Cela permet de garder votre historique propre. Cette action est d√©finitive.
                                </span>
                            </span>
                            <script>
                              (function(){
                                const el = document.currentScript.previousElementSibling;
                                if (!el) return;
                                const show = () => { const t = el.querySelector('.tooltip-content'); if (t){ t.style.opacity='1'; t.style.transform='translateY(0)'; } };
                                const hide = () => { const t = el.querySelector('.tooltip-content'); if (t){ t.style.opacity='0'; t.style.transform='translateY(4px)'; } };
                                el.addEventListener('mouseenter', show);
                                el.addEventListener('mouseleave', hide);
                                el.addEventListener('focus', show);
                                el.addEventListener('blur', hide);
                              })();
                            </script>
                            <div style="margin-left:auto; display:flex; align-items:center; gap:8px;">
                                <label for="sellerRetentionDaysInput" style="font-size:12px; color:#666;">Conservation (jours):</label>
                                <input type="number" id="sellerRetentionDaysInput" min="7" max="180" step="1" style="width:80px; padding:6px 8px; border:1px solid #ddd; border-radius:6px;" />
                            </div>
                        </div>
                        <div id="orders-list"></div>
                    </div>
                </div>
            </section>

            <section id="sec-settings" class="admin-section hidden">
                <h1 class="admin-page-title">Ma Vitrine</h1>
                <div class="admin-card">
                    <form id="form-settings">
                        
                        <h3 style="margin-top:0;">Identit√© Visuelle</h3>
                        <p class="text-muted" style="font-size:13px; margin-bottom:20px;">Personnalisez l'apparence de votre boutique.</p>

                        <div style="display:flex; gap:20px; flex-wrap:wrap;">
                            <div style="text-align:center;">
                                <label style="display:block; margin-bottom:8px;">Logo</label>
                                <div class="upload-area-mini" id="upload-logo" style="width:100px; height:100px; border-radius:50%; border:2px dashed #ddd; display:flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden; position:relative; margin:0 auto;">
                                    <img id="preview-logo" src="assets/img/placeholder.png" style="width:100%; height:100%; object-fit:cover;">
                                    <div style="position:absolute; inset:0; background:rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center; color:white; opacity:0; transition:0.2s;">
                                        <i data-lucide="camera"></i>
                                    </div>
                                </div>
                                <input type="file" id="file-logo" accept="image/*" hidden>
                            </div>

                            <div style="flex:1; min-width:200px;">
                                <label style="display:block; margin-bottom:8px;">Banni√®re</label>
                                <div class="upload-area-mini" id="upload-banner" style="width:100%; height:120px; border-radius:10px; border:2px dashed #ddd; display:flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden; position:relative;">
                                    <img id="preview-banner" src="assets/img/placeholder-banner.jpg" style="width:100%; height:100%; object-fit:cover;">
                                    <div style="position:absolute; inset:0; background:rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center; color:white; opacity:0; transition:0.2s;">
                                        <i data-lucide="image"></i> Modifier
                                    </div>
                                </div>
                                <input type="file" id="file-banner" accept="image/*" hidden>
                            </div>
                        </div>

                        <hr style="border:0; border-top:1px solid #eee; margin:30px 0;">

                        <h3>Informations</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label>Nom de la boutique</label>
                                <input class="input" id="set-name" required>
                            </div>
                            <div>
                                <label>Slogan</label>
                                <input class="input" id="set-slogan" placeholder="Ex: L'√©l√©gance au quotidien">
                            </div>
                        </div>

                        <div>
                            <label>Description compl√®te</label>
                            <textarea class="input" id="set-desc" rows="4" placeholder="Parlez de votre histoire..."></textarea>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label>Email Contact</label>
                                <input class="input" id="set-email" readonly style="background:#eee;">
                            </div>
                            <div>
                                <label>T√©l√©phone / WhatsApp</label>
                                <input class="input" id="set-phone" placeholder="+226...">
                            </div>
                        </div>

                        <div style="text-align:right; margin-top:20px;">
                            <button class="btn-gold" type="submit" style="width:auto; padding:12px 40px;">Enregistrer les modifications</button>
                        </div>
                    </form>
                </div>
            </section>

        </div>
    </main>

    <div id="toast-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 3000;"></div>

    <!-- Scripts charg√©s dans le head -->
</body>
</html>
