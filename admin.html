<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aurum Admin - Dashboard</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/admin.css" />

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
    /* =========================================================
       ESPACE ADMIN - GESTION GLOBALE AURUM (TOUT EN INLINE)
       ========================================================= */

    // Configuration Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBGmPM4OXEonp7qL78x20NC2DXvQW0lavU",
        authDomain: "aurum-bf.firebaseapp.com",
        projectId: "aurum-bf",
        storageBucket: "aurum-bf.firebasestorage.app",
        messagingSenderId: "858318726586",
        appId: "1:858318726586:web:14687fff6d4d08527a6983",
        measurementId: "G-SY7DY6WV97"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    // Exports globaux pour compat avec le reste du code
    window.db = db;
    window.auth = auth;

    // --- 1. LES DONN√É‚Ä∞ES DE BASE ---
    const INITIAL_DATA = {
        shops: [
            { name: 'Luxe Motors', category: 'Auto & Moto', ownerEmail: 'vente.lll@gmail.com', status: 'active', itemLimit: 50, createdAt: new Date() },
            { name: 'Boutique Faso', category: 'Mode & V√É¬™tements', ownerEmail: 'client.add@gmail.com', status: 'active', itemLimit: 100, createdAt: new Date() },
            { name: 'Electro World', category: '√É‚Ä∞lectronique', ownerEmail: 'tech@store.bf', status: 'active', itemLimit: 200, createdAt: new Date() }
        ],
        users: [
            { name: "Super Admin", email: "aurumcorporate.d@gmail.com", role: "superadmin", phone: "+226 00 00 00 00" },
            { name: "Vendeur Auto", email: "vente.lll@gmail.com", role: "seller", phone: "+226 70 00 00 01" },
            { name: "Client Test", email: "client.add@gmail.com", role: "client", phone: "+226 70 00 00 02" }
        ],
        promos: [
            { code: "AURUM10", percent: 10, expires: "2025-12-31", status: "active" },
            { code: "BIENVENUE", percent: 15, expires: "2025-06-01", status: "active" }
        ]
    };

    // Variables pour l'affichage
    let Store = { 
        shops: [], 
        users: [], 
        promos: [],
        categories: [],
        products: [],
        orders: []
    };

    // Utilitaire: corriger les textes mal encod√©s (UTF-8 affich√© en ISO)
    function fixGarbledText(root = document.body) {
        const map = new Map([
            ['√É¬©','√©'], ['√É¬®','√®'], ['√É¬™','√™'], ['√É¬´','√´'], ['√É¬¢','√¢'], ['√É¬§','√§'],
            ['√É ','√†'], ['√É¬°','√°'], ['√É‚Ç¨','√Ä'], ['√É¬¥','√¥'], ['√É¬∂','√∂'], ['√É¬ß','√ß'], ['√É‚Ä∞','√â'],
            ['Cat√É¬©gories','Cat√©gories'], ['Cr√É¬©er','Cr√©er'], ['D√É¬©connexion','D√©connexion'],
            ['Activit√É¬©','Activit√©'], ['R√É¬©cente','R√©cente'], ['Syst√É¬®me','Syst√®me'],
            ['T√É¬©l√É¬©phone','T√©l√©phone'], ['Propri√É¬©taire','Propri√©taire'], ['Dur√É¬©e','Dur√©e'],
            ['donn√É¬©es','donn√©es'], ['Acc√É¬®s','Acc√®s'], ['connect√É¬©','connect√©']
        ]);

        const fix = (s) => {
            if (!s) return s;
            let out = s;
            map.forEach((v,k)=>{ out = out.split(k).join(v); });
            // Emojis fr√©quemment mal encod√©s
            out = out.replaceAll('√¢≈ì‚Ä¶','‚úÖ').replaceAll('√¢¬ù≈í','‚ùå').replaceAll('√¢≈°¬°','‚ö°')
                     .replaceAll('√¢≈°¬†√Ø¬∏¬è','‚ö†Ô∏è').replaceAll('√∞≈∏‚Äú¬°','üì°').replaceAll('√∞≈∏‚Äù¬ê','üîê')
                     .replaceAll('√∞≈∏‚Äú¬¶','üì¶').replaceAll('√∞≈∏‚Äò¬•','üë•').replaceAll('√∞≈∏≈Ω¬Å','üéÅ')
                     .replaceAll('√∞≈∏‚Äî‚Äò√Ø¬∏¬è','üóëÔ∏è').replaceAll('√∞≈∏‚Ä∫¬ç√Ø¬∏¬è','üõçÔ∏è').replaceAll('√∞≈∏‚Äô¬∞','üí∞')
                     .replaceAll('√∞≈∏‚Äú¬ç','üìç');
            return out;
        };
        const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
        const nodes = [];
        while (walker.nextNode()) nodes.push(walker.currentNode);
        nodes.forEach(n => { n.nodeValue = fix(n.nodeValue); });
        document.title = fix(document.title);
    }

    // --- 2. D√É‚Ä∞MARRAGE ---
    const ADMIN_EMAIL = 'aurumcorporate.d@gmail.com';

    document.addEventListener('DOMContentLoaded', () => {
        try { fixGarbledText(); } catch (_) {}
        console.log('‚úÖ DOM Charg√©, initialisation admin...');
        
        window.auth.onAuthStateChanged((user) => {
            console.log('√∞≈∏‚Äù¬ê Auth state changed:', user?.email || 'Non connect√É¬©');
            
            if (!user) {
                // Non connect√É¬©
                console.log("√¢≈°¬†√Ø¬∏¬è Utilisateur non connect√É¬© -> Redirection");
                window.location.href = 'login.html';
                return;
            }
            
            if (user.email !== ADMIN_EMAIL) {
                // Connect√É¬© mais pas admin
                console.log("√¢¬ù≈í Acc√É¬®s refus√É¬© - Email non autoris√É¬©:", user.email);
                document.body.innerHTML = '<div style="display:flex; align-items:center; justify-content:center; height:100vh; font-family:Arial; text-align:center;"><div><h1 style="color:#ff6b6b;">Acc√®s Refus√©</h1><p style="font-size:18px;">Vous n\'√™tes pas autoris√© √† acc√©der √† cette page.</p><p style="color:#666;">Email: ' + user.email + '</p><a href="index.html" style="margin-top:20px; display:inline-block; padding:10px 20px; background:#007bff; color:white; text-decoration:none; border-radius:5px;">Retourner √† l\'accueil</a></div></div>';
                return;
            }
            
            // Acc√É¬®s autoris√É¬©
            console.log("√¢≈ì‚Ä¶ Acc√É¬®s administrateur autoris√É¬©");
            startRealTimeSync();
            setupNavigation();
        });
    });

    // --- 3. AUTO-REMPLISSAGE (SEEDING) ---
    async function checkAndSeedDatabase() {
        const snapshot = await db.collection('shops').limit(1).get();
        
        if (snapshot.empty) {
            console.log("√¢≈°¬° Base de donn√É¬©es vide -> Injection des donn√É¬©es de d√É¬©mo...");
            INITIAL_DATA.shops.forEach(shop => db.collection('shops').add(shop));
            INITIAL_DATA.users.forEach(user => db.collection('users').add(user));
            INITIAL_DATA.promos.forEach(promo => db.collection('promos').add(promo));
            alert("√∞≈∏≈Ω‚Ä∞ Base de donn√É¬©es initialis√É¬©e !");
        } else {
            console.log("√∞≈∏‚Äò¬ç Base de donn√É¬©es d√É¬©j√É¬† remplie.");
        }
    }

    // --- 4. SYNCHRONISATION (Lecture Firebase) ---
    function startRealTimeSync() {
        console.log('√∞≈∏‚Äú¬° D√É¬©marrage sync temps r√É¬©el...');
        
        // Masquer le loader et afficher le contenu imm√É¬©diatement
        setTimeout(() => {
            const loader = document.getElementById('loader');
            const content = document.getElementById('dashboard-content');
            if(loader) loader.style.display = 'none';
            if(content) content.classList.remove('hidden');
            console.log('√¢≈ì‚Ä¶ Interface affich√É¬©e');
        }, 500);
        
        // √É‚Ä∞coute Boutiques
        db.collection('shops').onSnapshot(snap => {
            console.log('√∞≈∏‚Äú¬¶ Boutiques:', snap.size);
            Store.shops = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderShops();
            renderStats();
        }, err => console.error('√¢¬ù≈í Erreur shops:', err));

        // √É‚Ä∞coute Users
        db.collection('users').onSnapshot(snap => {
            console.log('√∞≈∏‚Äò¬• Utilisateurs:', snap.size);
            Store.users = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderUsers();
            renderStats();
        }, err => console.error('√¢¬ù≈í Erreur users:', err));

        // √É‚Ä∞coute Promos
        db.collection('promos').onSnapshot(snap => {
            console.log('√∞≈∏≈Ω¬Å Promos:', snap.size);
            Store.promos = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderPromos();
            renderStats();
        }, err => console.error('√¢¬ù≈í Erreur promos:', err));

        // √É‚Ä∞coute Cat√É¬©gories
        db.collection('categories').onSnapshot(snap => {
            console.log('√∞≈∏¬è¬∑√Ø¬∏¬è Cat√É¬©gories:', snap.size);
            Store.categories = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderCategories();
        }, err => console.error('√¢¬ù≈í Erreur categories:', err));

        // Nettoyage automatique des codes promo expir√É¬©s (une fois par heure)
        setInterval(() => {
            const today = new Date().toISOString().split('T')[0];
            Store.promos.forEach(promo => {
                if(promo.expires && promo.expires < today) {
                    console.log('√∞≈∏‚Äî‚Äò√Ø¬∏¬è Suppression promo expir√É¬©:', promo.code);
                    db.collection('promos').doc(promo.id).delete();
                }
            });
        }, 3600000); // 1 heure

        // √É‚Ä∞coute Produits (optionnel)
        try {
            db.collectionGroup('products').onSnapshot(snap => {
                console.log('√∞≈∏‚Ä∫¬ç√Ø¬∏¬è Produits:', snap.size);
                Store.products = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderStats();
            }, err => {
                console.warn('√¢≈°¬†√Ø¬∏¬è Produits indisponible:', err.message);
                Store.products = [];
            });
        } catch (e) {
            console.warn('√¢≈°¬†√Ø¬∏¬è CollectionGroup non support√É¬©');
        }

        // √É‚Ä∞coute Commandes (optionnel)
        try {
            db.collection('orders').onSnapshot(snap => {
                console.log('√∞≈∏‚Äô¬∞ Commandes:', snap.size);
                Store.orders = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderStats();
            }, err => {
                console.warn('√¢≈°¬†√Ø¬∏¬è Orders indisponible:', err.message);
                Store.orders = [];
            });
        } catch (e) {
            console.warn('√¢≈°¬†√Ø¬∏¬è Collection orders non trouv√É¬©e');
        }

        // Ic√É¬¥nes
        if(typeof lucide !== 'undefined') lucide.createIcons();
    }

    // --- 5. AFFICHAGE (Render) ---
    function renderStats() {
        const div = document.getElementById('admin-stats');
        if(!div) return;
        
        let totalAmount = 0;
        Store.orders.forEach(order => {
            if(order.amount) {
                totalAmount += parseFloat(order.amount) || 0;
            } else if(order.items && Array.isArray(order.items)) {
                order.items.forEach(item => {
                    totalAmount += (parseFloat(item.price) || 0) * (item.qty || 1);
                });
            }
        });
        
        const formattedAmount = new Intl.NumberFormat('fr-FR', {
            style: 'currency',
            currency: 'XOF'
        }).format(totalAmount);
        
        div.innerHTML = `
            <div class="admin-stat-card">
                <div class="admin-stat-label">Boutiques Actives</div>
                <div class="admin-stat-value">${Store.shops.length}</div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-label">Comptes Utilisateurs</div>
                <div class="admin-stat-value">${Store.users.length}</div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-label">Produits</div>
                <div class="admin-stat-value">${Store.products.length}</div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-label">Ventes</div>
                <div class="admin-stat-value">${Store.orders.length}</div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-label">Montant Total</div>
                <div class="admin-stat-value" style="font-size:1.6em;">${formattedAmount}</div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-label">Promos Actives</div>
                <div class="admin-stat-value">${Store.promos.length}</div>
            </div>
        `;
    }

    function renderShops() {
        const div = document.getElementById('admin-shops');
        if(!div) return;
        div.innerHTML = Store.shops.length === 0 
            ? '<p>Chargement...</p>'
            : Store.shops.map(s => `
                <div class="admin-card" style="padding:15px; margin-bottom:10px;">
                    <h4>${s.name}</h4>
                    <div style="font-size:13px; color:#666;">${s.category} √¢‚Ç¨‚Äù ${s.ownerEmail}</div>
                </div>
            `).join('');
    }

    function renderUsers() {
        const div = document.getElementById('admin-users');
        if(!div) return;
        div.innerHTML = Store.users.map(u => `
            <div class="admin-card" style="padding:15px; margin-bottom:10px;">
                <strong>${u.name}</strong> <span>${u.role}</span><br>
                ${u.email}
            </div>
        `).join('');
    }

    function renderPromos() {
        const div = document.getElementById('admin-promos');
        if(!div) return;
        
        const today = new Date().toISOString().split('T')[0]; // Format YYYY-MM-DD
        
        div.innerHTML = Store.promos.length === 0 
            ? '<p>Aucun code promo</p>'
            : Store.promos.map(p => {
                const isExpired = p.expires && p.expires < today;
                const statusColor = isExpired ? '#999' : '#1a7f4a';
                const statusText = isExpired ? 'EXPIR√â' : 'ACTIF';
                
                return `
                    <div class="admin-card" style="padding:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; ${isExpired ? 'opacity:0.6;' : ''}">
                        <div style="flex:1;">
                            <strong style="font-size:16px; ${isExpired ? 'text-decoration:line-through;' : ''}">${p.code}</strong>
                            <div style="font-size:13px; color:#666;">
                                -${p.percent}% 
                                ${p.expires ? `√¢‚Ç¨¬¢ Expire: ${p.expires}` : '√¢‚Ç¨¬¢ Sans date'}
                                <span style="color:${statusColor}; font-weight:bold; margin-left:10px;">${statusText}</span>
                            </div>
                        </div>
                        <button onclick="deleteItem('promos', '${p.id}')" style="color:red; background:none; border:none; cursor:pointer; font-weight:bold;">√¢≈ì‚Ä¢ Supprimer</button>
                    </div>
                `;
            }).join('');
    }

    function renderCategories() {
        const div = document.getElementById('categories-list');
        if(!div) return;
        
        // Remplir aussi le select pour le formulaire de boutique
        const select = document.getElementById('shop-cat-select');
        if(select) {
            select.innerHTML = '<option value="">Choisir une cat√É¬©gorie...</option>' + 
                Store.categories.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
        }
        
        // Afficher la liste des cat√É¬©gories
        div.innerHTML = Store.categories.length === 0 
            ? '<p>Aucune cat√É¬©gorie</p>'
            : Store.categories.map(c => `
                <div class="admin-card" style="padding:15px; margin-bottom:10px; display:flex; justify-content:space-between;">
                    <strong>${c.name}</strong>
                    <button onclick="deleteItem('categories', '${c.id}')" style="color:red; background:none; border:none; cursor:pointer;">Supprimer</button>
                </div>
            `).join('');
    }

    // --- 6. NAVIGATION ---
    function setupNavigation() {
        console.log('√∞≈∏‚Äù‚Äî Configuration navigation...');
    }

    // Fonction globale de navigation (appel√É¬©e par onclick)
    window.nav = function(sectionId, clickedBtn) {
        console.log('√∞≈∏‚Äú¬ç Navigation vers:', sectionId);
        
        // Masquer toutes les sections
        document.querySelectorAll('.admin-section').forEach(section => {
            section.classList.add('hidden');
            section.classList.remove('active-section');
        });
        
        // Afficher la section demand√É¬©e
        const targetSection = document.getElementById('sec-' + sectionId);
        if(targetSection) {
            targetSection.classList.remove('hidden');
            targetSection.classList.add('active-section');
        }
        
        // Mettre √É¬† jour les boutons actifs
        document.querySelectorAll('.admin-nav-item').forEach(btn => {
            btn.classList.remove('active');
        });
        if(clickedBtn) {
            clickedBtn.classList.add('active');
        }
        
        // Fermer le menu mobile si ouvert
        const sidebar = document.getElementById('admin-sidebar');
        if(sidebar && window.innerWidth < 900) {
            sidebar.classList.remove('mobile-open');
        }
    };

    // --- GLOBAL DELETE ---
    window.deleteItem = function(col, id) {
        if(confirm("Supprimer ?")) {
            db.collection(col).doc(id).delete();
        }
    };

    // --- LOGOUT ---
    window.logout = function() {
        if(confirm("√ätes-vous s√ªr de vouloir vous d√©connecter ?")) {
            firebase.auth().signOut().then(function() {
                window.location.href = 'index.html';
            }).catch(function(error) {
                console.error('Erreur d√©connexion:', error);
                window.location.href = 'index.html';
            });
        }
    };

    console.log('√¢≈ì‚Ä¶ Script admin.html charg√É¬©');
    </script>
</head>
<body class="admin-layout">

    <aside class="admin-sidebar" id="admin-sidebar">
        <div class="admin-sidebar-header">
            <h1 class="admin-sidebar-title">Aurum</h1>
        </div>
        <nav>
            <div class="admin-nav-item active" onclick="nav('dashboard', this)">
                <i data-lucide="layout-dashboard"></i> Tableau de bord
            </div>
            <div class="admin-nav-item" onclick="nav('sellers', this)">
                <i data-lucide="user-plus"></i> Cr√É¬©er Vendeur
            </div>
            <div class="admin-nav-item" onclick="nav('shops', this)">
                <i data-lucide="store"></i> Boutiques
            </div>
            <div class="admin-nav-item" onclick="nav('categories', this)">
                <i data-lucide="tag"></i> Cat√É¬©gories
            </div>
            <div class="admin-nav-item" onclick="nav('users', this)">
                <i data-lucide="users"></i> Comptes
            </div>
            <div class="admin-nav-item" onclick="nav('promos', this)">
                <i data-lucide="percent"></i> Codes Promo
            </div>
        </nav>
        <div style="margin-top:30px; padding-top:20px; border-top:1px solid rgba(255,255,255,0.1);">
            <div class="admin-nav-item" style="color:#ff6b6b; cursor:pointer;" onclick="logout()">
                <i data-lucide="log-out"></i> D√É¬©connexion
            </div>
        </div>
    </aside>

    <button class="admin-mobile-toggle" onclick="document.getElementById('admin-sidebar').classList.toggle('mobile-open')">
        <i data-lucide="menu"></i>
    </button>

    <main class="admin-main">
        
        <div id="loader" style="text-align:center; margin-top:20%;">
            <p>Chargement des donn√É¬©es...</p>
        </div>

        <div id="dashboard-content" class="hidden">

            <section id="sec-dashboard" class="admin-section active-section">
                <h1 class="admin-page-title">Tableau de Bord</h1>
                <div class="stats-grid" id="admin-stats">
                    </div>
                <div class="admin-card">
                    <h3>Activit√É¬© R√É¬©cente</h3>
                    <p style="color:#666;">Syst√É¬®me synchronis√É¬© avec la base de donn√É¬©es.</p>
                </div>
            </section>

            <section id="sec-sellers" class="admin-section hidden">
                <h1 class="admin-page-title">Cr√É¬©er Vendeur</h1>
                <div class="admin-card">
                    <form id="form-seller">
                        <label>Nom Complet</label>
                        <input class="input" id="sel-name" required placeholder="Ex: Jean Dupont">
                        <label>Email</label>
                        <input class="input" id="sel-email" type="email" required placeholder="email@vendeur.com">
                        <label>T√É¬©l√É¬©phone</label>
                        <input class="input" id="sel-phone" required placeholder="+226 XX XX XX XX">
                        <label>Mot de passe</label>
                        <input class="input" id="sel-pass" required placeholder="******">
                        <button class="btn-gold">Cr√É¬©er le compte</button>
                    </form>
                </div>
            </section>

            <section id="sec-shops" class="admin-section hidden">
                <h1 class="admin-page-title">Boutiques</h1>
                <div class="admin-card">
                    <h3>Nouvelle Boutique</h3>
                    <form id="form-shop">
                        <input class="input" id="shop-name" placeholder="Nom de la boutique" required>
                        <input class="input" id="shop-owner" placeholder="Email du Propri√É¬©taire" required>
                        <select class="input" id="shop-cat-select" required></select>
                        <input class="input" id="shop-desc" placeholder="Description courte">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                            <input class="input" type="number" id="shop-duration" value="30" placeholder="Dur√É¬©e (jours)">
                            <input class="input" type="number" id="shop-limit" value="50" placeholder="Limite articles">
                        </div>
                        <button class="btn-gold">Ajouter la boutique</button>
                    </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des Boutiques</h3>
                    <div id="admin-shops">Chargement...</div>
                </div>
            </section>

            <section id="sec-categories" class="admin-section hidden">
                <h1 class="admin-page-title">Cat√É¬©gories</h1>
                <div class="admin-card">
                    <form id="form-cat" style="display:flex; gap:10px; margin-bottom:20px;">
                        <input class="input" id="cat-name" placeholder="Nouvelle cat√É¬©gorie" style="margin:0;">
                        <button class="btn-gold" style="width:auto; margin:0;">Ajouter</button>
                    </form>
                    <div id="categories-list"></div>
                </div>
            </section>

            <section id="sec-users" class="admin-section hidden">
                <h1 class="admin-page-title">Comptes Utilisateurs</h1>
                <div class="admin-card" id="admin-users">Chargement...</div>
            </section>

            <section id="sec-promos" class="admin-section hidden">
                <h1 class="admin-page-title">Codes Promo</h1>
                <div class="admin-card">
                    <form id="form-promo" style="display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; align-items:flex-end;">
                        <input class="input" id="promo-code" placeholder="CODE" style="margin:0;">
                        <input class="input" id="promo-val" type="number" placeholder="%" style="width:80px; margin:0;">
                        <input class="input" id="promo-expires" type="date" placeholder="Expiration" style="margin:0;">
                        <button class="btn-gold" style="width:auto; margin:0;">Cr√É¬©er</button>
                    </form>
                    <div id="admin-promos"></div>
                </div>
            </section>

        </div>
    </main>

    <script>
        // 1. CONFIGURATION
        // Firebase est d√É¬©sormais initialis√É¬© depuis assets/js/admin.js
        // Les objets globaux db et auth sont fournis par ce script.

        // Tout est g√É¬©r√É¬© par assets/js/admin.js
        // Ne pas dupliquer le code Firebase ici

        // 6. GESTION NAVIGATION
        window.nav = function(id, btn) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active-section'));
            document.getElementById('sec-'+id).classList.remove('hidden');
            document.getElementById('sec-'+id).classList.add('active-section');
            
            document.querySelectorAll('.admin-nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Fermer mobile
            if(window.innerWidth < 900) document.getElementById('admin-sidebar').classList.remove('mobile-open');
        };

        // 7. ACTIONS FORMULAIRES
        document.getElementById('form-shop').onsubmit = (e) => {
            e.preventDefault();
            const durationDays = Number(document.getElementById('shop-duration').value) || 30;
            const expiresAt = new Date();
            expiresAt.setDate(expiresAt.getDate() + durationDays);
            
            db.collection('shops').add({
                name: document.getElementById('shop-name').value,
                ownerEmail: document.getElementById('shop-owner').value,
                category: document.getElementById('shop-cat-select').value,
                description: document.getElementById('shop-desc').value,
                status: 'Active',
                createdAt: new Date(),
                expiresAt: expiresAt,
                durationDays: durationDays
            });
            e.target.reset();
            alert("Boutique ajout√©e !");
        };

        document.getElementById('form-seller').onsubmit = (e) => {
            e.preventDefault();
            const email = document.getElementById('sel-email').value;
            const pass = document.getElementById('sel-pass').value;
            const name = document.getElementById('sel-name').value;
            
            // Cr√©ation Auth
            window.auth.createUserWithEmailAndPassword(email, pass).then(cred => {
                // Sauvegarde DB
                db.collection('users').add({
                    name: name, email: email, phone: document.getElementById('sel-phone').value, role: 'seller', createdAt: new Date()
                });
                alert("Vendeur cr√©√© !");
                e.target.reset();
            }).catch(err => alert("Erreur: " + err.message));
        };

        document.getElementById('form-cat').onsubmit = (e) => {
            e.preventDefault();
            db.collection('categories').add({ name: document.getElementById('cat-name').value, icon: 'tag' });
            e.target.reset();
        };

        document.getElementById('form-promo').onsubmit = (e) => {
            e.preventDefault();
            const code = document.getElementById('promo-code').value;
            const percent = document.getElementById('promo-val').value;
            const expires = document.getElementById('promo-expires').value;
            
            db.collection('promos').add({ 
                code: code, 
                percent: parseInt(percent),
                expires: expires || null,
                createdAt: new Date(),
                status: 'active'
            });
            e.target.reset();
            alert('‚úÖ Code promo cr√©√©!');
        };

        // Delete Global
        window.del = (col, id) => {
            if(confirm("Supprimer ?")) db.collection(col).doc(id).delete();
        };

    </script>
</body>
</html>
