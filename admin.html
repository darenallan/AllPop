<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard Admin — Aurum</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <link rel="stylesheet" href="assets/css/styles.css" />

    <style>
        /* Layout PC Force */
        @media (min-width: 900px) {
            body.admin-layout {
                display: grid !important;
                grid-template-columns: 260px 1fr !important;
                min-height: 100vh;
                overflow: hidden;
            }
            .admin-sidebar {
                display: flex !important;
                flex-direction: column;
                background: #0F0F0F !important;
                color: #fff;
                height: 100vh !important;
                position: relative !important;
                z-index: 100;
                border-right: 1px solid rgba(255,255,255,0.1);
            }
            .admin-main {
                background: #F9F7F2;
                padding: 40px !important;
                height: 100vh;
                overflow-y: auto;
            }
            /* Cache le bouton burger sur PC */
            .admin-mobile-toggle { display: none !important; }
        }

        /* Styles Mobile */
        @media (max-width: 899px) {
            body.admin-layout { display: block !important; }
            .admin-sidebar { display: none; position: fixed; inset: 0; z-index: 999; }
            .admin-sidebar.mobile-open { display: flex !important; }
            .admin-main { padding: 20px; padding-top: 70px; }
            .admin-mobile-toggle {
                display: flex; position: fixed; top: 15px; right: 15px;
                background: #D4AF37; border: none; padding: 10px; border-radius: 50%; z-index: 1000;
            }
        }

        /* Navigation */
        .admin-sidebar-header { padding: 30px 20px; text-align: center; }
        .admin-sidebar-title { font-family: 'Playfair Display', serif; color: #D4AF37; font-size: 24px; margin: 0; }
        
        .admin-nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 20px;
            color: rgba(255,255,255,0.7); text-decoration: none; border-radius: 8px;
            margin: 0 10px 5px 10px; transition: 0.2s; cursor: pointer;
        }
        .admin-nav-item:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .admin-nav-item.active { background: #D4AF37; color: #000; font-weight: 700; }

        /* Sections */
        .admin-section { display: none; }
        .admin-section.active { display: block; animation: fadeIn 0.3s; }

        /* Cartes & Stats */
        .admin-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .admin-stat-card { background: #fff; padding: 24px; border-radius: 12px; border-left: 4px solid #D4AF37; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .admin-stat-value { font-size: 32px; font-weight: 700; color: #000; font-family: 'Playfair Display', serif; }
        .admin-stat-label { text-transform: uppercase; font-size: 12px; color: #666; margin-bottom: 5px; }

        .admin-card { background: #fff; padding: 24px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        /* Tableaux */
        .data-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .data-row:last-child { border-bottom: none; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status-active { background: #e6fffa; color: #007a5e; }
        
        /* Formulaires */
        .input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; display: block; box-sizing: border-box; }
        
        @keyframes fadeIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

</head>
<body class="admin-layout">

    <aside class="admin-sidebar" id="admin-sidebar">
        <div class="admin-sidebar-header">
            <h1 class="admin-sidebar-title">Aurum Admin</h1>
        </div>
        <nav>
            <div class="admin-nav-item active" onclick="switchTab('dashboard', this)">
                <i data-lucide="layout-dashboard"></i> Tableau de bord
            </div>
            <div class="admin-nav-item" onclick="switchTab('sellers', this)">
                <i data-lucide="user-plus"></i> Créer Vendeur
            </div>
            <div class="admin-nav-item" onclick="switchTab('shops', this)">
                <i data-lucide="store"></i> Boutiques
            </div>
            <div class="admin-nav-item" onclick="switchTab('users', this)">
                <i data-lucide="users"></i> Comptes
            </div>
            <div class="admin-nav-item" onclick="switchTab('promos', this)">
                <i data-lucide="percent"></i> Codes Promo
            </div>
            <a href="index.html" class="admin-nav-item" style="margin-top: 40px; color: #ff6b6b;">
                <i data-lucide="log-out"></i> Quitter
            </a>
        </nav>
    </aside>

    <button class="admin-mobile-toggle" onclick="document.getElementById('admin-sidebar').classList.toggle('mobile-open')">
        <i data-lucide="menu"></i>
    </button>

    <main class="admin-main">
        
        <div id="loader" style="text-align: center; margin-top: 100px;">
            <p>Chargement des données...</p>
        </div>

        <div id="dashboard-content" style="display: none;">

            <section id="section-dashboard" class="admin-section active">
                <h1 class="section-title">Tableau de Bord</h1>
                <div class="admin-stats-grid" id="stats-container">
                    </div>
            </section>

            <section id="section-sellers" class="admin-section">
                <h1 class="section-title">Créer un Vendeur</h1>
                <div class="admin-card">
                    <form id="form-seller">
                        <label>Nom complet</label>
                        <input type="text" id="seller-name" class="input" required>
                        <label>Email</label>
                        <input type="email" id="seller-email" class="input" required>
                        <label>Mot de passe</label>
                        <input type="text" id="seller-pass" class="input" required>
                        <button type="submit" class="btn btn-gold">Créer le compte</button>
                    </form>
                </div>
            </section>

            <section id="section-shops" class="admin-section">
                <h1 class="section-title">Boutiques</h1>
                <div class="admin-card">
                    <h3>Nouvelle Boutique</h3>
                    <form id="form-shop">
                        <input type="text" id="shop-name" class="input" placeholder="Nom de la boutique" required>
                        <input type="email" id="shop-owner" class="input" placeholder="Email Propriétaire" required>
                        <select id="shop-cat" class="input">
                            <option value="Mode">Mode</option>
                            <option value="Auto">Auto</option>
                            <option value="Maison">Maison</option>
                            <option value="Tech">High-Tech</option>
                        </select>
                        <button type="submit" class="btn btn-gold">Ajouter</button>
                    </form>
                </div>
                <div class="admin-card">
                    <h3>Liste des boutiques</h3>
                    <div id="list-shops"></div>
                </div>
            </section>

            <section id="section-users" class="admin-section">
                <h1 class="section-title">Utilisateurs</h1>
                <div class="admin-card" id="list-users"></div>
            </section>

            <section id="section-promos" class="admin-section">
                <h1 class="section-title">Promotions</h1>
                <div class="admin-card" id="list-promos"></div>
            </section>

        </div>
    </main>

    <script>
        // --- A. CONFIGURATION FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyBGmPM4OXEonp7qL78x20NC2DXvQW0lavU",
            authDomain: "aurum-bf.firebaseapp.com",
            projectId: "aurum-bf",
            storageBucket: "aurum-bf.firebasestorage.app",
            messagingSenderId: "858318726586",
            appId: "1:858318726586:web:14687fff6d4d08527a6983",
            measurementId: "G-SY7DY6WV97"
        };
        
        // Initialisation
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- B. LOGIQUE D'AFFICHAGE ---
        
        // Variables locales pour l'affichage
        let shops = [];
        let users = [];

        // 1. Vérification Admin au démarrage
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Si connecté (même si pas admin suprême pour le test), on affiche
                document.getElementById('loader').style.display = 'none';
                document.getElementById('dashboard-content').style.display = 'block';
                console.log("Connecté:", user.email);
                
                // Lancer la synchro des données
                syncData();
            } else {
                // Pas connecté -> Redirection
                window.location.href = "login.html";
            }
        });

        // 2. Synchronisation Firebase (Temps réel)
        function syncData() {
            // Écoute les boutiques
            db.collection('shops').onSnapshot((snap) => {
                shops = [];
                snap.forEach(doc => shops.push({id: doc.id, ...doc.data()}));
                renderShops();
                renderStats();
            });

            // Écoute les utilisateurs
            db.collection('users').onSnapshot((snap) => {
                users = [];
                snap.forEach(doc => users.push({id: doc.id, ...doc.data()}));
                renderUsers();
                renderStats();
            });
        }

        // 3. Fonctions de Rendu (Affichage HTML)
        function renderStats() {
            const container = document.getElementById('stats-container');
            container.innerHTML = `
                <div class="admin-stat-card">
                    <div class="admin-stat-label">Boutiques Actives</div>
                    <div class="admin-stat-value">${shops.length}</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-label">Comptes</div>
                    <div class="admin-stat-value">${users.length}</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-label">Ventes (Démo)</div>
                    <div class="admin-stat-value">1 886</div>
                </div>
            `;
        }

        function renderShops() {
            const list = document.getElementById('list-shops');
            if(shops.length === 0) {
                list.innerHTML = "<p>Aucune boutique.</p>";
                return;
            }
            list.innerHTML = shops.map(s => `
                <div class="data-row">
                    <div>
                        <strong>${s.name}</strong> <br> 
                        <small>${s.category} — ${s.ownerEmail}</small>
                    </div>
                    <div>
                        <span class="status-badge status-active">Active</span>
                        <button class="btn btn-sm" onclick="deleteItem('shops', '${s.id}')" style="margin-left:10px; color:red; background:none;">X</button>
                    </div>
                </div>
            `).join('');
        }

        function renderUsers() {
            const list = document.getElementById('list-users');
            list.innerHTML = users.map(u => `
                <div class="data-row">
                    <div><strong>${u.name}</strong> <br> ${u.email}</div>
                    <div class="status-badge" style="background:#eee;">${u.role}</div>
                </div>
            `).join('');
        }

        // 4. Actions (Formulaires)
        
        // Créer Vendeur
        document.getElementById('form-seller').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('seller-name').value;
            const email = document.getElementById('seller-email').value;
            const pass = document.getElementById('seller-pass').value;

            // Création Auth + DB
            auth.createUserWithEmailAndPassword(email, pass).then((cred) => {
                db.collection('users').add({
                    name: name, email: email, role: 'seller', createdAt: new Date()
                });
                alert("Vendeur créé !");
                e.target.reset();
            }).catch(err => alert("Erreur: " + err.message));
        });

        // Créer Boutique
        document.getElementById('form-shop').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('shop-name').value;
            const owner = document.getElementById('shop-owner').value;
            const cat = document.getElementById('shop-cat').value;

            db.collection('shops').add({
                name: name, ownerEmail: owner, category: cat, status: 'active', createdAt: new Date()
            }).then(() => {
                alert("Boutique ajoutée !");
                e.target.reset();
            });
        });

        // Suppression
        window.deleteItem = (col, id) => {
            if(confirm("Supprimer ?")) db.collection(col).doc(id).delete();
        };

        // Navigation Onglets
        window.switchTab = (tabId, btn) => {
            // Cacher toutes les sections
            document.querySelectorAll('.admin-section').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.admin-nav-item').forEach(el => el.classList.remove('active'));
            
            // Afficher la cible
            document.getElementById('section-' + tabId).style.display = 'block';
            btn.classList.add('active');
            
            // Fermer mobile
            if(window.innerWidth < 900) {
                document.getElementById('admin-sidebar').classList.remove('mobile-open');
            }
        };

        // Init Icons
        lucide.createIcons();

    </script>
</body>
</html>
